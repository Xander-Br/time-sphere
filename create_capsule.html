<!DOCTYPE html>
<html>
<head>
	<title>Form for date date and text</title>

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

</head>
<body>
	<form id="myForm">
		<label for="username">Username:</label>
		<textarea id="username" required></textarea><br>

		<label for="date_unlock_at">Date_unlock_at :</label>
		<input type="text" id="date_unlock_at" required><br>
	
		<label for="text">Text :</label>
		<textarea id="text" required></textarea><br>

		<label for="image">Image :</label>
		<input type="file" id="image" accept="image/*" required><br>

		<input type="submit" value="Send">
	</form>

	<script>
		// Initialize Flatpickr for the date input
		flatpickr("#date_unlock_at", {
			enableTime: true,
			dateFormat: "Y-m-d H:i:S",
			time_24hr: true
		});

		//get the values of the form
		function sendForm(event) {
			event.preventDefault();

			let username = document.getElementById('username').value;
			let date_unlock_at = document.getElementById('date_unlock_at').value;
			let data_text = document.getElementById('text').value;
			let img = document.getElementById('image').files[0];

			// Get the user's geolocation
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(function(position) {
					// Create the form data with the user's location
					const formData = new FormData();
					formData.append("username", username);
					formData.append("unlock_at", date_unlock_at);
					formData.append("longitude", position.coords.longitude);
					formData.append("latitude", position.coords.latitude);
					formData.append("text", data_text);
					formData.append("img", img);

					// Send the data to the server
					let xhr = new XMLHttpRequest();
					xhr.open('POST', 'http://127.0.0.1:8000/create');
					
					xhr.onload = function(){
						if (xhr.status === 200){
							console.log('Succes !!');
						}
						else{
							console.log('Erreur!!!')
						}
					};
					xhr.send(formData);

					// Display the data on console
					console.log('Username : ' + username);
					console.log('Date_unlock_at : ' + date_unlock_at);
					console.log('Text : ' + data_text);
					console.log('Image : ' + img.name);
					console.log('Location : ' + position.coords.latitude + ', ' + position.coords.longitude);
					console.log({"type": "Point", "coordinates": [position.coords.longitude, position.coords.latitude]});
				});
			} else {
				console.log("Geolocation is not supported by this browser.");
			}
		}

		// Add event listener for the form
		let form = document.getElementById('myForm');
		form.addEventListener('submit', sendForm);
	</script>
</body>
</html>
